@tailwind base;
@tailwind components;
@tailwind utilities;

/* Prevent CLS from font loading */
@layer base {
  html {
    /* Prevent layout shifts from scrollbar */
    scrollbar-gutter: stable;
  }

  /* ============================================
   * DALAT COLOR PALETTE - "Pine & Mist"
   * Inspired by Dalat's pine forests, morning mist,
   * coffee culture, and highland tranquility.
   *
   * Philosophy: Distinctive, calm, nature-forward.
   * Pine green primary makes this instantly recognizable.
   * ============================================ */

  :root {
    /* === LIGHT MODE: "Morning in the Pines" === */
    /* Soft mist, filtered forest light, quiet elegance */

    /* Core semantic colors */
    --background: 40 25% 98%;           /* warm off-white, hint of cream */
    --foreground: 160 15% 15%;          /* pine-tinted dark, not pure black */
    --card: 40 20% 97%;                 /* subtle warmth on cards */
    --card-foreground: 160 15% 15%;
    --popover: 40 20% 99%;
    --popover-foreground: 160 15% 15%;

    /* Primary: Pine Forest - calm, distinctive, grounded */
    --primary: 158 35% 32%;             /* deep pine green - the signature */
    --primary-foreground: 0 0% 100%;

    /* Secondary: Warm stone - earthy, supportive */
    --secondary: 35 20% 93%;            /* warm light stone */
    --secondary-foreground: 35 25% 30%;

    /* Muted: Morning mist - soft, receding */
    --muted: 160 10% 94%;               /* barely green-gray */
    --muted-foreground: 160 8% 45%;

    /* Accent: Soft sky blue - fresh highland air */
    --accent: 200 30% 94%;              /* very light sky */
    --accent-foreground: 200 40% 30%;

    /* Destructive: Muted warm red (not alarming) */
    --destructive: 0 60% 50%;
    --destructive-foreground: 0 0% 100%;

    /* UI elements */
    --border: 35 15% 88%;               /* warm gray border */
    --input: 35 15% 88%;
    --ring: 158 35% 32%;                /* pine green focus ring */

    /* Charts - nature palette */
    --chart-1: 158 35% 35%;             /* pine green */
    --chart-2: 35 65% 55%;              /* warm gold */
    --chart-3: 200 45% 50%;             /* sky blue */
    --chart-4: 25 55% 45%;              /* coffee brown */
    --chart-5: 280 25% 55%;             /* misty purple */

    /* === EXTENDED DALAT PALETTE === */
    /* For badges, highlights, special UI moments */
    --dalat-pine: 158 35% 32%;          /* same as primary */
    --dalat-pine-light: 158 25% 92%;    /* light pine wash */
    --dalat-gold: 38 75% 50%;           /* warm gold - for highlights */
    --dalat-gold-light: 40 60% 92%;     /* light gold wash */
    --dalat-coffee: 25 55% 35%;         /* rich coffee */
    --dalat-coffee-light: 30 40% 90%;   /* coffee cream */
    --dalat-hydrangea: 220 45% 55%;     /* hydrangea blue */
    --dalat-hydrangea-light: 220 35% 93%;
    --dalat-mist: 260 20% 65%;          /* misty purple */
    --dalat-mist-light: 260 15% 95%;

    --radius: 0.5rem;
  }

  .dark {
    /* === DARK MODE: "Evening Cafe" === */
    /* Warm lamp light, wood tables, steaming coffee */
    /* Not corporate blue-black, but cozy brown-black */

    /* Core semantic colors */
    --background: 30 20% 7%;            /* coffee-black, warm undertone */
    --foreground: 35 15% 90%;           /* warm cream text */
    --card: 30 18% 11%;                 /* elevated surface, still warm */
    --card-foreground: 35 15% 90%;
    --popover: 30 18% 9%;
    --popover-foreground: 35 15% 90%;

    /* Primary: Brighter pine for dark backgrounds */
    --primary: 158 40% 45%;             /* lighter pine, still recognizable */
    --primary-foreground: 160 30% 8%;   /* dark pine for contrast */

    /* Secondary: Warm dark stone */
    --secondary: 30 15% 18%;            /* dark warm stone */
    --secondary-foreground: 35 20% 85%;

    /* Muted: Deep forest shadow */
    --muted: 160 10% 15%;               /* dark pine-gray */
    --muted-foreground: 160 8% 55%;

    /* Accent: Deep sky */
    --accent: 200 25% 20%;              /* dark sky blue */
    --accent-foreground: 200 30% 85%;

    /* Destructive: Softened for dark */
    --destructive: 0 50% 45%;
    --destructive-foreground: 0 0% 95%;

    /* UI elements */
    --border: 30 12% 20%;               /* warm dark border */
    --input: 30 12% 20%;
    --ring: 158 40% 45%;                /* pine green focus */

    /* Charts - dark mode optimized */
    --chart-1: 158 40% 50%;             /* brighter pine */
    --chart-2: 38 70% 55%;              /* warm gold */
    --chart-3: 200 40% 55%;             /* sky blue */
    --chart-4: 25 50% 50%;              /* coffee */
    --chart-5: 280 25% 55%;             /* mist purple */

    /* === EXTENDED DALAT PALETTE (dark mode) === */
    --dalat-pine: 158 40% 45%;
    --dalat-pine-light: 158 20% 15%;    /* dark pine bg */
    --dalat-gold: 38 70% 55%;
    --dalat-gold-light: 38 40% 15%;     /* dark gold bg */
    --dalat-coffee: 25 50% 50%;
    --dalat-coffee-light: 25 30% 15%;
    --dalat-hydrangea: 220 40% 55%;
    --dalat-hydrangea-light: 220 25% 18%;
    --dalat-mist: 260 20% 55%;
    --dalat-mist-light: 260 15% 18%;
  }

  /* === MIDNIGHT: Pure OLED Black === */
  /* For OLED screens and those who prefer true black */
  .midnight {
    --background: 0 0% 0%;              /* pure black */
    --foreground: 0 0% 95%;             /* bright white text */
    --card: 0 0% 5%;                    /* barely lifted surface */
    --card-foreground: 0 0% 95%;
    --popover: 0 0% 3%;
    --popover-foreground: 0 0% 95%;

    --primary: 158 40% 50%;             /* brighter pine for contrast */
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 12%;
    --secondary-foreground: 0 0% 90%;

    --muted: 0 0% 10%;
    --muted-foreground: 0 0% 55%;

    --accent: 200 30% 25%;
    --accent-foreground: 200 30% 90%;

    --destructive: 0 55% 50%;
    --destructive-foreground: 0 0% 100%;

    --border: 0 0% 15%;
    --input: 0 0% 15%;
    --ring: 158 40% 50%;

    --chart-1: 158 45% 55%;
    --chart-2: 38 75% 60%;
    --chart-3: 200 45% 60%;
    --chart-4: 25 55% 55%;
    --chart-5: 280 30% 60%;

    --dalat-pine: 158 45% 50%;
    --dalat-pine-light: 158 25% 10%;
    --dalat-gold: 38 75% 60%;
    --dalat-gold-light: 38 45% 10%;
    --dalat-coffee: 25 55% 55%;
    --dalat-coffee-light: 25 35% 10%;
    --dalat-hydrangea: 220 45% 60%;
    --dalat-hydrangea-light: 220 30% 12%;
    --dalat-mist: 260 25% 60%;
    --dalat-mist-light: 260 20% 12%;
  }

  /* === FOREST: Deep Pine Greens === */
  /* Nature-forward, immersed in Da Lat's pine forests */
  .forest {
    --background: 160 25% 6%;           /* deep forest floor */
    --foreground: 140 10% 92%;          /* soft green-white */
    --card: 160 22% 10%;                /* moss-covered elevation */
    --card-foreground: 140 10% 92%;
    --popover: 160 22% 8%;
    --popover-foreground: 140 10% 92%;

    --primary: 158 45% 48%;             /* vibrant pine */
    --primary-foreground: 160 30% 6%;

    --secondary: 160 18% 16%;           /* shadowed undergrowth */
    --secondary-foreground: 140 15% 88%;

    --muted: 160 15% 14%;               /* deep shadow */
    --muted-foreground: 160 10% 55%;

    --accent: 180 25% 22%;              /* teal forest pool */
    --accent-foreground: 180 25% 88%;

    --destructive: 0 50% 48%;
    --destructive-foreground: 0 0% 95%;

    --border: 160 15% 18%;              /* forest edge */
    --input: 160 15% 18%;
    --ring: 158 45% 48%;

    --chart-1: 158 45% 52%;
    --chart-2: 80 50% 50%;              /* leaf green */
    --chart-3: 180 40% 50%;             /* teal */
    --chart-4: 140 35% 45%;             /* sage */
    --chart-5: 200 35% 50%;             /* misty blue */

    --dalat-pine: 158 45% 48%;
    --dalat-pine-light: 160 25% 12%;
    --dalat-gold: 80 50% 55%;
    --dalat-gold-light: 80 35% 12%;
    --dalat-coffee: 140 35% 45%;
    --dalat-coffee-light: 140 25% 12%;
    --dalat-hydrangea: 200 40% 55%;
    --dalat-hydrangea-light: 200 25% 14%;
    --dalat-mist: 180 25% 55%;
    --dalat-mist-light: 180 18% 14%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* ============================================
 * THEME TRANSITION SYSTEM
 * Smooth 300ms transitions when switching themes
 * ============================================ */

html:not(.no-transitions) *,
html:not(.no-transitions) *::before,
html:not(.no-transitions) *::after {
  transition-property: color, background-color, border-color, box-shadow, fill, stroke;
  transition-duration: 300ms;
  transition-timing-function: ease-out;
}

/* Exclude elements that shouldn't transition (prevents image/video flash) */
html:not(.no-transitions) img,
html:not(.no-transitions) video,
html:not(.no-transitions) canvas,
html:not(.no-transitions) [data-no-theme-transition] {
  transition: none !important;
}

/* ============================================
 * HERO VISUAL EFFECTS
 * Film grain, light leak for organic Dalat vibes
 * ============================================ */

/* Subtle film grain texture for organic feel */
.hero-grain::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  opacity: 0.03;
  pointer-events: none;
  mix-blend-mode: overlay;
}

/* Light leak effect - soft morning light filtering through pines */
.hero-light-leak::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 40%;
  height: 60%;
  background: radial-gradient(
    ellipse at 100% 0%,
    hsl(158 35% 50% / 0.08),
    transparent 70%
  );
  pointer-events: none;
  mix-blend-mode: overlay;
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .animate-hero-breathe {
    animation: none !important;
  }
  .animate-hero-fade-up {
    animation: none !important;
    opacity: 1 !important;
  }
}

/* Novu inbox mobile scroll lock - prevents background from moving when swiping in inbox */
[class*="nv-inbox__popover"],
[class*="nv-popover"],
[class*="nv-root"] [role="dialog"] {
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y pinch-zoom;
}

/* Lock body scroll when Novu popover is open */
body:has([class*="nv-popover"][data-state="open"]),
body:has([class*="nv-inbox__popover"][data-state="open"]),
body:has([class*="nv-root"] [role="dialog"][data-state="open"]) {
  overflow: hidden;
  overscroll-behavior: none;
}

/* Ensure Novu notification list doesn't propagate scroll */
[class*="nv-notificationList"],
[class*="nv-notification-list"],
[class*="nv-inbox"] [role="listbox"],
[class*="nv-inbox"] [role="list"] {
  overscroll-behavior: contain;
  touch-action: pan-y;
}

/* Scrollbar hide utility for immersive scroll-snap */
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

/* Performance: Prevent layout shifts from images */
img {
  content-visibility: auto;
}

/* Reduce animation jank with GPU acceleration for common transitions */
.transition-transform,
.transition-all,
.animate-pulse,
.animate-spin {
  will-change: transform;
}

/* Optimize font rendering */
body {
  text-rendering: optimizeSpeed;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Reduce paint areas for fixed elements */
.fixed {
  contain: layout style;
}

/* Content visibility optimization for below-fold content */
@media (min-width: 1024px) {
  footer {
    content-visibility: auto;
    contain-intrinsic-size: auto 200px;
  }
}

/* Map marker pulsing animation for "happening now" events */
@keyframes pulse-ring {
  0% {
    transform: scale(0.95);
    opacity: 1;
  }
  70%, 100% {
    transform: scale(1.3);
    opacity: 0;
  }
}

/* Celebration modal - nuclear option centering that overrides everything */
.celebration-center {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  z-index: 9999 !important;
}
